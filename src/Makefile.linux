# gcc-multilib is useful for cross-compiling, that is, compiling a program to run on a different processor architecture. For example, you would need gcc-multilib if you are running on 64-bit Ubuntu and want to compile a program to run on 32-bit Ubuntu (or on ARM etc. you get the idea).

# Run: make Release 
# Run: make Debug 
CC=g++
#comflag = -m32
comflag =
OUT_DIR_RLS = ./out_linux_rls
OUT_DIR_DBG = ./out_linux_dbg

# DSPELIB_DIR_NAME = CodeBlocks-m32_TDM_5.1.0
DSPELIB_DIR_NAME = VisualStudioCode_linux

INSTALL_DIR_ROOT = ~/workspace/_DSPE_lib_linux_

INCLUDES_DBG := -I./src/include -I./src/include/dbg 
INCLUDES_RLS := -I./src/include -I./src/include/rls
#LIBS := -lwinmm -lws2_32
LIBS := -lasound

# \TODO is DEVCPP ok or is it unnecessary
DFLAGS         = -DLINUX -DDEVCPP 
CFLAGS_release = $(comflag) -std=c++0x -O3 -Wall -c -fmessage-length=0 -fno-strict-aliasing 
CFLAGS_debug   = $(comflag) -std=c++0x -O0 -g3 -Wall -c -fmessage-length=0 -W -Wshadow -Wconversion -fstrict-aliasing
# -U__STRICT_ANSI__ jest potrzebne do kompilacji debug_new.cpp, je�eli pomin�� ten plik to mo�na r�wnie� wyrzuci� t� opcj�
#CFLAGS_debug   = $(comflag) -std=c++0x -O0 -g3 -Wall -c -fmessage-length=0 -W -Wshadow -Wco#nversion -fstrict-aliasing -U__STRICT_ANSI__


SRC_SUBDIR = src/cpp
#SOURCES = Main.cpp
SOURCES = 
SOURCES += DSP_AudioMixer.cpp DSP_Fourier.cpp DSP_misc.cpp DSP_clocks.cpp DSP_modules.cpp DSP_modules2.cpp 
SOURCES += DSP_DOT.cpp DSP_modules_misc.cpp DSP_IO.cpp DSP_logstream.cpp
SOURCES += DSP_logstream.cpp 
SOURCES += ALSA_support.cpp 

# ################################################# #
# Just sockets // currently not supported in Linux
#SOURCES_SOCKETS = DSP_sockets.cpp 
SOURCES_SOCKETS = 


# ################################################# #
# RELEASE
OBJECTS_Release 		:= $(SOURCES:%.cpp=$(OUT_DIR_RLS)/$(SRC_SUBDIR)/%.o)
OBJECTS_SOCKETS_Release := $(SOURCES_SOCKETS:%.cpp=$(OUT_DIR_RLS)/$(SRC_SUBDIR)/%.o)





# ################################################# #
# DEBUG
OBJECTS_Debug 		  := $(SOURCES:%.cpp=$(OUT_DIR_DBG)/$(SRC_SUBDIR)/%.o)
OBJECTS_SOCKETS_Debug := $(SOURCES_SOCKETS:%.cpp=$(OUT_DIR_DBG)/$(SRC_SUBDIR)/%.o)

# SRC_DBG_SUBDIR = nvwa
# SOURCES_MISC_Debug += debug_new.cpp
# OBJECTS_MISC_Debug := $(SOURCES_MISC_Debug:%.cpp=$(OUT_DIR_DBG)/$(SRC_DBG_SUBDIR)/%.o)
OBJECTS_MISC_Debug := 

# ################################################# #

all: Debug Release


# ########################################################################################### #	
# ########################################################################################### #	
Release: $(OUT_DIR_RLS)/libDSPE.a $(OUT_DIR_RLS)/libDSPEsockets.a

$(OUT_DIR_RLS)/libDSPE.a: $(OBJECTS_Release) 
	@echo Preparing lib file $@
	ar rc $@ $(OBJECTS_Release)
	ranlib $@

$(OUT_DIR_RLS)/libDSPEsockets.a:  $(OBJECTS_SOCKETS_Release)
	@echo Preparing lib file $@
	ar rc $@  $(OBJECTS_SOCKETS_Release)
	ranlib $@

# Z podanej listy usuwany $(OUT_DIR_RLS)/ oraz '.o' zamieniamy na '.cpp'
$(OBJECTS_Release) $(OBJECTS_SOCKETS_Release): $(OUT_DIR_RLS)/%.o : %.cpp
	@echo $(@D) $< $@
	
	#mkdir -p $(OUT_DIR_RLS)/$(SRC_SUBDIR)
	mkdir -p $(@D)
	$(CC) $(DFLAGS) $(CFLAGS_release) $(INCLUDES_RLS) $< -o $@

# ########################################################################################### #	
# ########################################################################################### #	
Debug: $(OUT_DIR_DBG)/libDSPE.a $(OUT_DIR_DBG)/libDSPEsockets.a

$(OUT_DIR_DBG)/libDSPE.a: $(OBJECTS_Debug) $(OBJECTS_MISC_Debug)
	@echo Preparing lib file $@
	ar rc $@ $(OBJECTS_Debug) $(OBJECTS_MISC_Debug)
	ranlib $@
$(OUT_DIR_DBG)/libDSPEsockets.a:  $(OBJECTS_SOCKETS_Debug)
	@echo Preparing lib file $@
	ar rc $@  $(OBJECTS_SOCKETS_Debug)
	ranlib $@

# Z podanej listy usuwany $(OUT_DIR_RLS)/ oraz '.o' zamieniamy na '.cpp'
$(OBJECTS_Debug) $(OBJECTS_SOCKETS_Debug) $(OBJECTS_MISC_Debug): $(OUT_DIR_DBG)/%.o : %.cpp
	@echo $(@D) $< $@
	
	mkdir -p $(@D)
	$(CC) $(DFLAGS) $(CFLAGS_debug) $(INCLUDES_DBG) $< -o $@

clean:
	@if [ -d "$(OUT_DIR_DBG)" ]; then \
		echo "cleaning $(OUT_DIR_DBG) ..."; \
		#find $(OUT_DIR_DBG)/ -name "*.o" -type f -delete; \
		rm -rf $(OUT_DIR_DBG)/$(SRC_SUBDIR)/*.o; \
		rm -rf $(OUT_DIR_DBG)/$(SRC_SUBDIR); \
		rm -rf $(OUT_DIR_DBG)/*.a; \
		rm -rf $(OUT_DIR_DBG); \
		echo "cleaned $(OUT_DIR_DBG)"; \
	fi 
	@if [ -d "$(OUT_DIR_RLS)" ]; then \
		echo "cleaning $(OUT_DIR_RLS) ..."; \
		#find $(OUT_DIR_RLS)/ -name "*.o" -type f -delete; \
		rm -rf $(OUT_DIR_RLS)/$(SRC_SUBDIR)/*.o; \
		rm -rf $(OUT_DIR_RLS)/$(SRC_SUBDIR); \
		rm -rf $(OUT_DIR_RLS)/*.a; \
		rm -rf $(OUT_DIR_RLS); \
		echo "cleaned $(OUT_DIR_RLS)"; \
	fi 
	
.PHONY: all Debug Release clean

# \TODO install - przygotowanie biblioteki w wersji u�ytkowej
